# <center> git高级
## 版本库管理
	1. 有两种方式管理和发布用于协作开发的版本库：
		1. 集中式版本库：
			集中式版本库并不代表集中式管理系统，集中式版本库指的是通过一个集中共享的版本库
			来协调的，但是工作完全是按照分布式开发的流程进行的。
		2. 分布式版本库
	2. 服务器的概念：
		1. 从技术上来讲，git是不需要服务器的，不一定需要一个服务器来架设git版本库。
		2. 在git版本库环境中建立一个服务器往往比搭建一个遍历且固定的用于交换更新的版本库需要更多的东西.(也就是说，搭建一个git服务器往往比建立一个版本库要更加的复杂)
		3. git并没有尝试去管理提交的权限，而是把这个问题交给了其他的工具，比如ssh
		4. 如果你希望你发布的版本库是单调递增的，并且不会删除对象和引用，你可以在克隆裸版本库的时候，使用--reference respository、--local、或者是--shared选项来完成。
		5. 在任何情况下发布一个版本库的时候，都需要发布一个裸版本库.（也就是说没有工作目录的仓库，只包含.git目录，不包含其他的资料）
	3. 如何架设一台git服务器
		1. 首先，选择你希望服务器使用的通信协议：
			1. git可以使用四种主要的协议来传输资料；本地协议(local)、HTTP协议、SSH协议以及GIT原生协议。
			2. 本地协议(local)：
				1. 最基本的就是本地协议，适用于团队中的每一个成员都对一个共享的文件系统拥有访问的权限
				2. 如果你使用共享文件系统，就可以从本地版本库克隆、推送以及拉取
				3. 如果在url的开头明确指定文件的路径，那么git的行为会不同，如果仅是指定路径，git会尝试使用硬连接或者是直接复制所需要的文件，如果指定file://，git会触发平时用于网络传输资料的进程，那通常是传输效率较低的方法
				指定file://的主要目的是为了取得一个没有外部参考或者对象的干净版本库的副本
				4. 添加一个本地版本库到已经存在的git项目，可以执行git remote add 远程仓库引用时的名称 远程仓库的位置(路径)
				5. 最后，就可像从网络上一样从远程版本库中拉取和推送更新了
				6. 优点：基于文件系统的版本库的优点是简单，直接使用了现有文件权限和网络访问权限，如果你的团队已经有了共享文件系统，建立版本库将会变得十分容易，只需要将裸版本库放到大家都可以访问的路径，并且设置好读写的权限
				7. 这也是从别人的工作目录中拉取更新的方法
				8. 缺点：通过共享文件比较难以配置，并且比基本的网络连接访问，不方便从多个位置进行访问
				速度慢，不能避免仓库意外的遭受损害，每一个用户否都拥有远程仓库目录的完整的shell权限，没有办法阻止删除或者谁修改git的内部文件和损害仓库.
		3. HTTP协议
			1. git通过http通信有两种模式，哑协议和智能协议
			2. 哑协议: 如果服务器没有提供智能HTTP协议的服务，git客户端会尝试使用简单的哑协议
			哑协议是在传输的过程中，抓取的过程其实就是一系列http的GET请求。
			哑协议里web服务器仅把裸版本库当作普通文件来看待，提供文件服务，哑协议的优点在于设置简单，基本上，只需要将一个裸版本库放在HTTP的根目录，设置一个post-update的钩子就可以了。
			只要能访问到该版本库，就可以克隆你的版本库
			git自带的post-update钩子会默认执行合适的命令(git update-server-info)
			来确保通过http的获取和克隆操作正常工作，这条命令会在你通过SSH向版本库推送之后被执行，然后别人就可以使用http协议克隆
			3. 智能协议：可以读出本地数据并且计算出那些是客户端需要的，并且生成合适的数据
			智能协议的运行方式和ssh以及git的协议类似，只是运行在标准的HTTPS端口上并且可以使用各种HTTP验证机制
			使用起来比ssh简单的多，可以使用HTTP协议的用户名/密码的基础授权，免去设置ssh公钥
			智能协议是现在最流行的git使用方式了，它既支持像git://协议一样设置匿名服务，也可以像ssh协议一样提供传输是的授权和加密，而且只用一个URl就可以做到
			通常只会在智能协议和哑协议之间选择一个来进行提供，两者很少混合使用.
			4. 优点：
				1. 智能协议的优点：不同的访问方式只需要一个url以及授权的信息就可以，相比
					于SSH协议，可以使用授权的信息是一个优势，不必要上传密钥，http协议和ssh协议一样，也是十分高效的。
				2. 可以在HTTPS协议上提供只读版本库的服务，你可以在传输数据的时候加密数据，或者可以让客户端使用指定的SSL证书。
				3. HTTPS协议被广泛的使用，一般的企业防火墙都会允许这些端口访问
			5. 缺点：
				1. 在一些服务器上，架设HTTPS协议的服务会比SSH的稍微棘手
				2. 如果在HTTPS协议上使用需要验证的推送，管理凭证会比SSH棘手，你可以选择使用凭证存储工具
		4. SSH协议
			1. 架设GIT服务器的时候经常使用的是ssh协议作为传输的协议，因为大多数环境下服务器已经支持通过SSH进行访问
			2. SSH协议也是一个验证授权的协议，架设和使用都很容易
			3. 优点：
				1. 架设起来相对简单，ssh守护进程是很常见的，并且多数操作系统上都有和ssh相关的管理工具
				2. ssh访问是安全的，所有数据传输都要经过授权和加密
				3. ssh协议很高效，传输的时候会尽量的压缩数据。
			4. 缺点：
				1. 不能实现匿名访问，不利于开源的项目，如果你要同时提供匿名只读访问和ssh协议，你除了架设ssh服务之外，还得架设一个可以让其他人访问的服务。
		5， git协议
			1. 包含在git里面的一个特殊的守护进程，他监听在一个特殊的端口(9418)，类似于ssh服务，但是不需要授权
			2. 要让版本库支持git协议，需要先创建一个git-daemon-export-ok文件，他是git协议守护进程为这个版本库提供服务的必要条件，但是除此之外没有任何安全措施
			3. 一般情况下不能使用git协议进行推送，因为没有授权机制，一旦开放了推送操作，所有人都可以进行推送
			4. 优点：
				1. git协议是传输的速度最快的，他使用的是和ssh相同的数据传输机制，但是省去了加密和授权的开销。 
			5. 缺点：
				1. 缺乏授权机制，作为访问项目版本库的唯一手段是不可取的，一般会同时提供ssh和http协议的访问服务，git协议也是最难架设的
				2. 他要求有自己的守护进程，需要配置其他程序，并且防火墙需要开放9418端口
				但是企业防火墙一般不会开放非标准端口
## 发布版本库
	1. 如果你希望你发布的版本库是单调递增的，并且不会删除对象和引用，你可以在克隆裸版本库的时候，使用--reference respository、--local、或者是--shared选项来完成。
	2. 当你需要发布一个版本库的时候，应该发布的是裸版本库。 	3. 发布带有访问控制的版本库：使用ssh协议，进行安全验证和加密，只有有权限访问主机的人才能够推送代码。
	4. 发布允许匿名访问的版本库：使用智能协议或者是git协议，允许匿名访问并且不需要授权和验证
	5. 如果你的版本库在公开的服务器上，那么所有人都可以克隆并且推送更新到这个项目
	6. 使用git-daemon发布版本库
		1. 使用的是git协议（git协议是传输最快的协议，不需要安全验证和授权）
		2. 可以在裸版本库的顶级目录中创建文件git-daemon-export-ok文件来将版本库标记为可以导出。
		3. 可以让你通过使用守护进程到处的版本库有更细粒度的控制。
		4. 为了避免单独标记某一个版本库，可以在运行git-daemon 命令的时候加上--export-all来
		发布所有在目录列表中可以识别的版本库，也就是拥有.git目录的版本库
		git-daemon命令还有许多选项来限制并且设置那些版本库会导出
		5. 在服务器上建立git-daemon的一种常见的方式是将它作为一个inted服务器启动，这需要在/etc/service目录中确保有git条目
		6. 默认端口是9418
	7. 使用http协议发布版本库
		1. 在启动http进程之前，需要在裸版本库中进行配置调整，启动hooks/post-update选项
		2. 必须确保post-update脚本是可执行的，可以使用chmod 755来更改
		3. 将裸版本库复制到http守护进程服务的目录
	8. 使用智能协议发布版本库
		未完待续
		



## 补丁 
	1. git实现了自己的传输协议，git再传输数据的时候会进行一次握手，用来确定哪些变更是在本地，哪些变更是只存在远程仓库的
	2. git传输的数据都是经过压缩的
	3. 远程版本库会将新的变更放到工作目录中，并且更新提交历史，引用和分支
	4. git还支持使用email来交换数据
	5. git实现了三条特殊的命令来帮助交换补丁
		1. git format-patch  -->  会生成email形式的补丁
		2. git send-email  -->  会通过简单的邮件传输协议生成一个补丁
		3. git am  ---> 应用文件中的补丁
		4. git format-patch 会给你选中的每一次提交都生成一个邮件形式的补丁
		5. git diff  和 git format-patch的区别
			1. git diff 生成的是选中的提交范围的总的差异的补丁，但是format-patch生成的是每一个提交差异的补丁
			2. git diff 不会生成邮件，git format-patch 会自动生成邮件并且携带提交的信息